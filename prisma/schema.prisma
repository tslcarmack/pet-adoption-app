// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADOPTER
  ADMIN
}

enum PetSpecies {
  DOG
  CAT
  OTHER
}

enum PetGender {
  MALE
  FEMALE
}

enum PetSize {
  SMALL
  MEDIUM
  LARGE
}

enum PetStatus {
  AVAILABLE
  PENDING
  ADOPTED
}

enum VaccinationStatus {
  NONE
  PARTIAL
  COMPLETE
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  WITHDRAWN
}

enum HousingType {
  OWN
  RENT
}

enum LivingSituation {
  HOUSE
  APARTMENT
  OTHER
}

model User {
  id                   String                @id @default(cuid())
  email                String                @unique
  emailVerified        DateTime?
  password             String
  name                 String
  phone                String?
  avatar               String?
  role                 UserRole              @default(ADOPTER)
  resetToken           String?
  resetTokenExpiry     DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  
  // Relations
  adoptionApplications AdoptionApplication[]
  favorites            Favorite[]
  
  @@index([email])
  @@map("users")
}

model Pet {
  id                String            @id @default(cuid())
  name              String
  species           PetSpecies
  breed             String
  age               Int               // in months
  gender            PetGender
  size              PetSize
  description       String            @db.Text
  healthStatus      String?           @db.Text
  vaccinationStatus VaccinationStatus @default(NONE)
  location          String            // city/region
  status            PetStatus         @default(AVAILABLE)
  photos            String[]          // array of image URLs
  adoptedAt         DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  // Relations
  adoptionApplications AdoptionApplication[]
  favorites            Favorite[]
  
  @@index([species])
  @@index([status])
  @@index([location])
  @@index([breed])
  @@map("pets")
}

model AdoptionApplication {
  id          String            @id @default(cuid())
  userId      String
  petId       String
  status      ApplicationStatus @default(PENDING)
  
  // Application data
  fullName    String
  email       String
  phone       String
  address     String
  housingType HousingType
  livingSituation LivingSituation
  householdMembers Int
  occupation  String?
  monthlyIncome String?
  hasYard     Boolean           @default(false)
  
  // Pet experience
  hasPetExperience Boolean       @default(false)
  previousPetType  String?
  yearsOfExperience Int?
  previousPetOutcome String?     @db.Text
  hasCurrentPets  Boolean        @default(false)
  currentPetsInfo String?        @db.Text
  
  // Motivation
  motivation  String            @db.Text
  
  // Review
  reviewerNotes String?         @db.Text
  submittedAt DateTime          @default(now())
  reviewedAt  DateTime?
  updatedAt   DateTime          @updatedAt
  
  // Relations
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  pet         Pet               @relation(fields: [petId], references: [id], onDelete: Cascade)
  
  @@unique([userId, petId])
  @@index([userId])
  @@index([petId])
  @@index([status])
  @@map("adoption_applications")
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  petId     String
  createdAt DateTime @default(now())
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  pet       Pet      @relation(fields: [petId], references: [id], onDelete: Cascade)
  
  @@unique([userId, petId])
  @@index([userId])
  @@index([petId])
  @@map("favorites")
}

model PasswordReset {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  used      Boolean  @default(false)
  
  @@index([email])
  @@index([token])
  @@map("password_resets")
}

model EmailVerification {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  verified  Boolean  @default(false)
  
  @@index([email])
  @@index([token])
  @@map("email_verifications")
}
